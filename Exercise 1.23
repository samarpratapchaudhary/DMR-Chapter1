/* Write a program to remove all comments from a C program. Donâ€™t forget to handle quoted strings and character constants properly. C comments do not nest. */
#include <stdio.h>

#define NORMAL 0
#define SLASH 1
#define IN_COMMENT 2
#define IN_STRING 3
#define IN_CHAR 4
#define ESCAPE 5

int main() {
    int c, state = NORMAL;

    while ((c = getchar()) != EOF) {
        if (state == NORMAL) {
            if (c == '/') {
                state = SLASH;   // maybe start of comment
            } else if (c == '"') {
                putchar(c);
                state = IN_STRING;
            } else if (c == '\'') {
                putchar(c);
                state = IN_CHAR;
            } else {
                putchar(c);
            }
        } 
        
        else if (state == SLASH) {
            if (c == '*') {
                state = IN_COMMENT;  // start of comment
            } else {
                putchar('/');
                putchar(c);  // not a comment
                state = NORMAL;
            }
        } 
        
        else if (state == IN_COMMENT) {
            if (c == '*') {
                int d = getchar();
                if (d == '/') {
                    state = NORMAL;  // end of comment
                } else {
                    ungetc(d, stdin);
                }
            }
            // else: ignore everything inside comment
        } 
        
        else if (state == IN_STRING) {
            putchar(c);
            if (c == '\\') {
                state = ESCAPE;  // escape sequence in string
            } else if (c == '"') {
                state = NORMAL;  // end string
            }
        } 
        
        else if (state == IN_CHAR) {
            putchar(c);
            if (c == '\\') {
                state = ESCAPE;  // escape sequence in char
            } else if (c == '\'') {
                state = NORMAL;  // end char literal
            }
        } 
        
        else if (state == ESCAPE) {
            putchar(c);
            // after printing escaped char, go back
            if (c == '"')
                state = IN_STRING;
            else if (c == '\'')
                state = IN_CHAR;
            else
                state = NORMAL;
        }
    }
    return 0;
}
